# This is a basic workflow to help you get started with Actions


name: CI

concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true

on:
  schedule:
    - cron: '*/15 * * * *'
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'
        required: true
        default: 'warning'
        type: choice
        options:
          - info
          - warning
          - debug
      print_tags:
        description: 'True to print to STDOUT'
        required: true
        type: boolean
      tags:
        description: 'Test scenario tags'
        required: true
        type: string
      environment:
        description: 'Environment to run tests against'
        type: environment
        required: true
      node-version:
        description: 'node-version'
        required: true
        default: '16'
        type: choice
        options:
          - "12"
          - "14"
          - "16"

jobs:

  release:
    runs-on: ubuntu-latest
    steps:

      - name: Set current datetime as env variable
        env:
          TZ: 'Asia/Tokyo'
        run: echo "CURRENT_DATETIME=$(date +'%Y%m%d%H%M%S')" >> $GITHUB_ENV

      - uses: actions/checkout@v2
        with:
          node-version: ${{ matrix.node }}
          persist-credentials: true
          ref: ${{ github.head_ref }}
          fetch-depth: 0
      - run: |
          set -x
          assets=()
          for asset in ./*.md; do
            assets+=("-a" "$asset")
          done
          tag_name="${CURRENT_DATETIME}${GITHUB_REF##*/}"
          hub release create "${assets[@]}" -pm "$tag_name" "$tag_name"
          echo "::group::My title"
          echo "::workflow-command parameter1={data},parameter2={data}::{command value}"
          echo "::endgroup::"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  call-workflow-passing-data:
    uses: ./.github/workflows/print-tag.yml
    with:
      username: ${{ inputs.username }}
      token: ${{ secrets.token }}
    secrets:
      envPAT: ${{ secrets.envPAT }}

  call-workflow-commit-data:
    uses: ./.github/workflows/add_commmit.yml
    with:
      username: ${{ inputs.username }}
      token: ${{ secrets.token }}
    secrets:
      envPAT: ${{ secrets.envPAT }}
